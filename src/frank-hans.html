<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="plotly-latest.min.js"></script>

    <style>
    #myDiv {
        width: 1600px;
        height: 750px;
    }
    </style>
</head>
<body>
<!-- <div id="tester" style="width:600px;height:250px;"></div>
<script>
    TESTER = document.getElementById('tester');
    Plotly.plot( TESTER, [{
        x: [0, 2, 3, 4, 5],
        y: [3, 0, 4, 8, 16] }], {
        margin: { t: 0 } } );
</script> -->

<div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>

<script>

   var data = [{ x: 6.1101, y: 17.592 },
{ x: 5.5277, y: 9.1302 },
{ x: 8.5186, y: 13.662 },
{ x: 7.0032, y: 11.854 },
{ x: 5.8598, y: 6.8233 },
{ x: 8.3829, y: 11.886 },
{ x: 7.4764, y: 4.3483 },
{ x: 8.5781, y: 12 },
{ x: 6.4862, y: 6.5987 },
{ x: 5.0546, y: 3.8166 },
{ x: 5.7107, y: 3.2522 },
{ x: 14.164, y: 15.505 },
{ x: 5.734, y: 3.1551 },
{ x: 8.4084, y: 7.2258 },
{ x: 5.6407, y: 0.71618 },
{ x: 5.3794, y: 3.5129 },
{ x: 6.3654, y: 5.3048 },
{ x: 5.1301, y: 0.56077 },
{ x: 6.4296, y: 3.6518 },
{ x: 7.0708, y: 5.3893 },
{ x: 6.1891, y: 3.1386 },
{ x: 20.27, y: 21.767 },
{ x: 5.4901, y: 4.263 },
{ x: 6.3261, y: 5.1875 },
{ x: 5.5649, y: 3.0825 },
{ x: 18.945, y: 22.638 },
{ x: 12.828, y: 13.501 },
{ x: 10.957, y: 7.0467 },
{ x: 13.176, y: 14.692 },
{ x: 22.203, y: 24.147 },
{ x: 5.2524, y: -1.22 },
{ x: 6.5894, y: 5.9966 },
{ x: 9.2482, y: 12.134 },
{ x: 5.8918, y: 1.8495 },
{ x: 8.2111, y: 6.5426 },
{ x: 7.9334, y: 4.5623 },
{ x: 8.0959, y: 4.1164 },
{ x: 5.6063, y: 3.3928 },
{ x: 12.836, y: 10.117 },
{ x: 6.3534, y: 5.4974 },
{ x: 5.4069, y: 0.55657 },
{ x: 6.8825, y: 3.9115 },
{ x: 11.708, y: 5.3854 },
{ x: 5.7737, y: 2.4406 },
{ x: 7.8247, y: 6.7318 },
{ x: 7.0931, y: 1.0463 },
{ x: 5.0702, y: 5.1337 },
{ x: 5.8014, y: 1.844 },
{ x: 11.7, y: 8.0043 },
{ x: 5.5416, y: 1.0179 },
{ x: 7.5402, y: 6.7504 },
{ x: 5.3077, y: 1.8396 },
{ x: 7.4239, y: 4.2885 },
{ x: 7.6031, y: 4.9981 },
{ x: 6.3328, y: 1.4233 },
{ x: 6.3589, y: -1.4211 },
{ x: 6.2742, y: 2.4756 },
{ x: 5.6397, y: 4.6042 },
{ x: 9.3102, y: 3.9624 },
{ x: 9.4536, y: 5.4141 },
{ x: 8.8254, y: 5.1694 },
{ x: 5.1793, y: -0.74279 },
{ x: 21.279, y: 17.929 },
{ x: 14.908, y: 12.054 },
{ x: 18.959, y: 17.054 },
{ x: 7.2182, y: 4.8852 },
{ x: 8.2951, y: 5.7442 },
{ x: 10.236, y: 7.7754 },
{ x: 5.4994, y: 1.0173 },
{ x: 20.341, y: 20.992 },
{ x: 10.136, y: 6.6799 },
{ x: 7.3345, y: 4.0259 },
{ x: 6.0062, y: 1.2784 },
{ x: 7.2259, y: 3.3411 },
{ x: 5.0269, y: -2.6807 },
{ x: 6.5479, y: 0.29678 },
{ x: 7.5386, y: 3.8845 },
{ x: 5.0365, y: 5.7014 },
{ x: 10.274, y: 6.7526 },
{ x: 5.1077, y: 2.0576 },
{ x: 5.7292, y: 0.47953 },
{ x: 5.1884, y: 0.20421 },
{ x: 6.3557, y: 0.67861 },
{ x: 9.7687, y: 7.5435 },
{ x: 6.5159, y: 5.3436 },
{ x: 8.5172, y: 4.2415 },
{ x: 9.1802, y: 6.7981 },
{ x: 6.002, y: 0.92695 },
{ x: 5.5204, y: 0.152 },
{ x: 5.0594, y: 2.8214 },
{ x: 5.7077, y: 1.8451 },
{ x: 7.6366, y: 4.2959 },
{ x: 5.8707, y: 7.2029 },
{ x: 5.3054, y: 1.9869 },
{ x: 8.2934, y: 0.14454 },
{ x: 13.394, y: 9.0551 },
{ x: 5.4369, y: 0.61705 },
];


    let population = data.map(item => item.x);
    let profit = data.map(item => item.y)


    // intial weights
    let theta0 = Math.random() * 10 - 5;
    let theta1 = Math.random() * 10 - 5;

    const alpha = 0.001;

    const m = data.length;
    const h = x => theta0 + (theta1 * x);
    const sumFn = (acc, cur) => { return acc + cur};
    let j = 1/(2*m) * 
        data
            .map(point => Math.pow(h(point.x)-point.y, 2)) // costs per point
            .reduce(sumFn, 0); // summed costs

    let initYs = population.map(h);

    let secondTrace = {
        x: population,
        y: initYs,
        mode: 'lines',
        type: 'scatter'
    }

    var dataPoints = {
        x: population,
        y: profit,
        mode: 'markers',
        type: 'scatter'
    };

    let predict = (x, y) => {
        let actualCost = h(x)*10000;
        console.log(`We predict that ${actualCost} should equal ${y}`, `the difference is ${y-actualCost}`);
    };

    var layout = {
      title: `Food truck trainingset, with J: ${j.toFixed(4)} for θ0: ${theta0.toFixed(4)}, θ1: ${theta1.toFixed(4)} and α: ${alpha}`,
      xaxis: {title: 'Population, in 10.000s'},
      yaxis: {title: 'Profit, in $ 10.000s'}
    };

let traces = [dataPoints, secondTrace];
    Plotly.newPlot('myDiv', traces, layout);

    fnRunNTimes = (fn, call, n) => {
        if(n > 0) {
          fn();
        
          if(n%50 === 0){
            let newTrace = {
                x: population,
                y: population.map(h),
                mode: 'lines',
                type: 'scatter'
            }

    let jnew = 1/(2*m) * 
        data
            .map(point => Math.pow(h(point.x)-point.y, 2)) // costs per point
            .reduce(sumFn, 0); // summed costs
            let newLayout = {
                title: `Food truck trainingset, with J: ${jnew.toFixed(4)} for θ0: ${theta0.toFixed(4)}, θ1: ${theta1.toFixed(4)} and α: ${alpha} (${n})`,
                xaxis: {title: 'Population, in 10.000s'},
                yaxis: {title: 'Profit, in $ 10.000s'}
            };
            traces[1] = newTrace;
            Plotly.redraw('myDiv');
            Plotly.relayout('myDiv', newLayout);
          }
          setTimeout(()=> {
            fnRunNTimes(fn, call, n-1);
          }, 2);
        } else {
            call();
        }
    };

    fnRunNTimes( function () {
      tempTheta0 = theta0 - (alpha / m) * data.map(point => h(point.x)-point.y).reduce(sumFn, 0);
      theta1 = theta1 - (alpha / m) * data.map(point => (h(point.x)-point.y)*point.x).reduce(sumFn, 0);
      theta0 = tempTheta0;
    }, function () {
        predict(3.5, 4519.767868);
        predict(7, 45342.450129);
    }, 15000);

//}, 2000);

</script>
</body>
</html>